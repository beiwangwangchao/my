<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../../../pages/taglibs.jsp"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
	  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	  <title>烟草业务系统</title>
	  <link href="${r'${'}ctx}/css/bootstrap/easyui.css" rel="stylesheet" type="text/css" />
	  <link href="${r'${'}ctx}/css/style.css" rel="stylesheet" type="text/css" />
	  <script type="text/javascript" src="${r'${'}ctx}/js/jquery-1.8.3.min.js"></script>
	  <script type="text/javascript" src="${r'${'}ctx}/js/jquery.easyui.min.js"></script>
	  <script type="text/javascript" src="${r'${'}ctx}/js/jquery.utils.js"></script>
	</head>
	<body>
 	 <div class="center">
		<div class="top">
			<div class="btn">
				<ul>
					<li>
						<span id="add${entity_name}"><a href="#" class="easyui-linkbutton" onclick="javascript:add${entity_name}Dialog()">新增</a></span>
					</li>
					<li>
						<span id="delete${entity_name}"><a href="#" class="easyui-linkbutton" onclick="javascript:delete${entity_name}();">删除</a></span>
					</li>
				</ul>
			</div>
	    </div>
	    <div class="main" style="padding: -1px;">
		   <table id="tt" style="width:960px;height:440px"></table>
		</div>
		<div id="add${entity_name}Dialog" closed="true" class="easyui-dialog" resizable="false" title="添加菜单" style="width:330px; height:200px;top:100px;left:250px; padding: 15px;" 
				data-options="iconCls:'icon-save',resizable:true,modal:true,buttons:[
				{text:'保存',handler:function(){ add${entity_name}();}}, 
				{text:'关闭',handler:function(){ $('#add${entity_name}Dialog').dialog('close');}}]"> 
				<div style="width:300px; height: auto; padding: 10px; margin: 0px 0px 10px 0px;" class="easyui-panel" noheader="true">
					<table border="0">
					<#list beans as bean>
					  <#if bean.propName != bean.keyName>
					   <tr>
					     <td style="padding:5px">${bean.remarks}</td><td><input id="c_${bean.propName}"/></td>
					   </tr>
					  </#if>
					</#list>
					</table>
				</div>
		</div> 
		<div id="update${entity_name}Dialog" closed="true" class="easyui-dialog" resizable="false" title="修改菜单" style="width:330px; height:200px;top:100px;left:250px; padding: 15px;" 
				data-options="iconCls:'icon-save',resizable:true,modal:true,buttons:[
				{text:'更新',handler:function(){ update${entity_name}();}}, 
				{text:'关闭',handler:function(){ $('#add${entity_name}Dialog').dialog('close');}}]"> 
				<div style="width:300px; height: auto; padding: 10px; margin: 0px 0px 10px 0px;" class="easyui-panel" noheader="true">
					<table border="0">
					 <#list beans as bean>
					 <#if bean.propName == bean.keyName>
					   <tr>
					     <td style="padding:5px">${bean.remarks}</td><td><label id="u_${bean.propName}"/></td>
					   </tr>
					   <#else>
					     <tr>
					     <td style="padding:5px">${bean.remarks}</td><td><input id="u_${bean.propName}"/></td>
					   </tr>
					 </#if>
					 </#list>
					</table>
				</div>
		</div>
	 </div>
     <script type="text/javascript">
        $(function(){
        	${r'${'}sessionScope.MONITOR_AUTH_STRING}
        	initGrid();
        });
        function initGrid(){
       	 $('#tt').datagrid({
       		    url:'${r'${'}ctx}//get${entity_name}Page.do',
       		    idField : "${entity_key}",
       		    pagination:true,
       			rownumbers : true,
       		    fitColumns : true,
       			collapsible : true,
       		    autoRowHeight : true,
       		    loadMsg : "数据加载中,请稍等...",
       		    frozenColumns : [[{field : 'ck',checkbox : true}]],
       		    columns:[[
       		     <#list beans as bean>
       		                 {title:'${bean.remarks}', field:'${bean.propName}',width:50,align:'center'},
       		     </#list>
                             {title : '操作',  field : 'n',width:100,align:'center',  
         		               formatter:function(value,row,index){
         		            		return '<a href="#" onclick="javascript:update${entity_name}Dialog('+row.${entity_key}+')">修改</a>';
         					 }}
       		            ]]
       	 });
       }
       function add${entity_name}(){
             <#list beans as bean>
              <#if bean.propName != bean.keyName>
               var ${bean.propName} = $('#c_${bean.propName}').val();
              </#if> 
             </#list>
             <#list beans as bean>
              <#if bean.propName != bean.keyName>
               if(${bean.propName}==null || ${bean.propName} ==''){
                 $.messager.alert('提示','请输入${bean.remarks}!','info');
            	 return;
               }
              </#if>
             </#list>
          	 $.ajax({
    			url:"${r'${'}ctx}//addRole.do",
    			type:"POST",
    			data:{<#list beans as bean>'${bean.propName}':${bean.propName}</#list>},
    			dataType:"json",
    			async: false,
    			success:function(data){
    				$.messager.alert('提示',data,'info');
    				$('#add${entity_name}Dialog').dialog('close');
    				$('#tt').datagrid('reload');
    			},error:function(data){
    				$.messager.alert('提示',data,'error');
    			}
    		 });
       }
       function update${entity_name}(){
           <#list beans as bean>
              <#if bean.propName == bean.keyName>
               var ${bean.propName} = $('#u_${bean.propName}').text();
               <#else>
               var ${bean.propName} = $('#u_${bean.propName}').val();
              </#if>
           </#list>
           <#list beans as bean>
               <#if bean.propName != bean.keyName>
               if(${bean.propName}==null || ${bean.propName} ==''){
                 $.messager.alert('提示','请输入${bean.remarks}!','info');
            	 return;
               }
               </#if>
           </#list>
        	$.ajax({
  			url:"${r'${'}ctx}//update${entity_name}.do",
  			type:"POST",
  			data:{<#list beans as bean>'${bean.propName}':${bean.propName}</#list>,'id':${entity_key}},
  			dataType:"json",
  			async: false,
  			success:function(data){
  				$.messager.alert('提示',data,'info');
  				$('#update${entity_name}Dialog').dialog('close');
  				$('#tt').datagrid('reload');
  			},error:function(data){
  				$.messager.alert('提示',data,'error');
  			}
  		 });
       }
       function add${entity_name}Dialog(){
    	   clear();
    	   $('#add${entity_name}Dialog').dialog('open');
       }
       function update${entity_name}Dialog(id){
    	   $('#bizType').val('update');
    	  	$.ajax({
    			url:'${r'${'}ctx}//get${entity_name}ById.do',
    			type:"POST",
    			data:{'id':${entity_key}},
    			dataType:"json",
    			async: false,
    			success:function(data){
    				if(null!=data){
    				 clear();
    				 <#list beans as bean>
    				  <#if bean.propName == bean.keyName>
    				   $('#u_${bean.propName}').text(data.${bean.propName});
    				  <#else>
    				   $('#u_${bean.propName}').val(data.${bean.propName});
    				  </#if>
		             </#list>
    				 $('#update${entity_name}Dialog').dialog('open');
    				}
    			},error:function(data){
    				$.messager.alert('提示',data,'error');
    			}
    		});
       }
       function clear(){
           <#list beans as bean>
            $('#c_${bean.propName}').val('');
            $('#u_${bean.propName}').val('');
		   </#list>
       }
	 </script>
	</body>
</html>