<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ include file="../../../pages/taglibs.jsp"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
	  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	  <title>后台管理系统</title>
	  <link href="${r'${'}ctx}/css/style.css" rel="stylesheet" type="text/css" />
	  <link href="${r'${'}ctx}/css/themes/icon.css" rel="stylesheet" type="text/css" />
	  <link href="${r'${'}ctx}/css/themes/bootstrap/easyui.css" rel="stylesheet" type="text/css" />
	  <script type="text/javascript" src="${r'${'}ctx}/js/jquery-1.8.3.min.js"></script>
	  <script type="text/javascript" src="${r'${'}ctx}/js/jquery.easyui.min.js"></script>
	  <script type="text/javascript" src="${r'${'}ctx}/js/jquery.showLoading.js"></script>
	</head>
	<body>
	<div class="place">
	    <span>位置：</span>
	    <ul class="placeul">
		    <li><a href="#">首页</a></li>
		    <li><a href="#">表单</a></li>
	    </ul>
    </div>
    <div class="rightinfo">
		    <div class="tools">
		    	<ul class="toolbar">
		        <li class="click" id="add${entity_name}"    onclick="javascript:add${entity_name}Dialog();" style="display:none;"><span><a href="#"><img src="${r'${'}ctx}/images/t01.png"/></a></span>添加</li>
		        <li class="click" id="update${entity_name}" onclick="javascript:add${entity_name}Dialog();" style="display:none;"><span><a href="#"><img src="${r'${'}ctx}/images/t02.png"/></a></span>修改</li>
		        <li class="click" id="delete${entity_name}" onclick="javascript:add${entity_name}Dialog();" style="display:none;"><span><a href="#"><img src="${r'${'}ctx}/images/t03.png"/></a></span>删除</li>
		        </ul>
		    </div>
		   <div>
	    		<table id="tt" style="width:1024px;height:452px"></table>
	       </div>
	       <div id="addRoleDialog" title="添加菜单" class="easyui-dialog" closed="true"  style="width:560px;height:260px;padding:10px" data-options="iconCls:'icon-save'" buttons="#add_buttons">
		       <div class="tab">
				    <form>
						<fieldset style="width:520px">
						  <legend>带<b>*</b>为必填项</legend>
							<table border="0">
								<#list beans as bean>
								     <#if bean.propName != bean.keyName>
									   <tr>
									     <td>${bean.remarks}<b>*</b></td><td><input id="c_${bean.propName}"/></td>
									   </tr>
									  </#if>
								</#list>
								</table>
						  </fieldset>
					</form>
			  </div>
	    </div>
	    <div id="addRoleDialog" title="修改菜单" class="easyui-dialog" closed="true"  style="width:560px;height:260px;padding:10px" data-options="iconCls:'icon-save'" buttons="#update_buttons">
		       <div class="tab">
				    <form>
						<fieldset style="width:520px">
						  <legend>带<b>*</b>为必填项</legend>
							<table border="0">
								<#list beans as bean>
									 <#if bean.propName == bean.keyName>
									   <tr>
									     <td>${bean.remarks}</td><td><label id="u_${bean.propName}">"/></label></td>
									   </tr>
									   <#else>
									     <tr>
									     <td>${bean.remarks}<b>*</b></td><td><input id="u_${bean.propName}"/></td>
									   </tr>
									 </#if>
								</#list>
								</table>
						  </fieldset>
					</form>
			  </div>
	    </div>
	    
	    <div id="add_buttons">
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" onclick="add${entity_name}();">提交</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="$('#add${entity_name}Dialog').dialog('close');">取消</a>
	    </div>
	    <div id="update_buttons">
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-ok" onclick="update${entity_name}();">提交</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="$('#update${entity_name}Dialog').dialog('close');">取消</a>
	    </div>
    </div>
     <script type="text/javascript">
        $(function(){
        	${r'${'}sessionScope.PAGE_SECURITY_AUTH_STRING}
        	initGrid();
        });
		function initGrid(){
			 $('#tt').datagrid({
				url:'${r'${'}ctx}//get${entity_name}Page',
				idField : "${entity_key}",
				pagination:true,
				rownumbers : true,
				fitColumns : true,
				collapsible : true,
				autoRowHeight : true,
				loadMsg : "数据加载中,请稍等...",
				frozenColumns : [[{field : 'ck',checkbox : true}]],
				columns:[[
				 <#list beans as bean>
				             {title:'${bean.remarks}', field:'${bean.propName}',width:50,align:'center'}<#if bean_has_next>,</#if>
				 </#list>
				        ]]
			 });
		}
       function add${entity_name}(){
             <#list beans as bean>
              <#if bean.propName != bean.keyName>
               var ${bean.propName} = $('#c_${bean.propName}').val();
              </#if> 
             </#list>
             <#list beans as bean>
              <#if bean.propName != bean.keyName>
               if(${bean.propName}==null || ${bean.propName} ==''){
                 $.messager.alert('提示','请输入${bean.remarks}!','info');
            	 return;
               }
              </#if>
             </#list>
             showLoading();
          	 $.ajax({
    			url:"${r'${'}ctx}//add${entity_name}",
    			type:"POST",
    			data:{<#list beans as bean><#if bean.propName != bean.keyName>'${bean.propName}':${bean.propName}<#if bean_has_next>,</#if></#if></#list>},
    			dataType:"json",
    			async: false,
    			success:function(data){
    				hideLoading();
    				$.messager.alert('提示',data,'info');
    				$('#add${entity_name}Dialog').dialog('close');
    				$('#tt').datagrid('reload');
    			},error:function(data){
    				hideLoading();
    				$.messager.alert('提示',data,'error');
    			}
    		 });
       }
       function update${entity_name}(){
           <#list beans as bean>
              <#if bean.propName == bean.keyName>
               var ${bean.propName} = $('#u_${bean.propName}').text();
               <#else>
               var ${bean.propName} = $('#u_${bean.propName}').val();
              </#if>
           </#list>
           <#list beans as bean>
               <#if bean.propName != bean.keyName>
               if(${bean.propName}==null || ${bean.propName} ==''){
                 $.messager.alert('提示','请输入${bean.remarks}!','info');
            	 return;
               }
               </#if>
           </#list>
           showLoading();
        	$.ajax({
  			url:"${r'${'}ctx}//update${entity_name}",
  			type:"POST",
  			data:{<#list beans as bean>'${bean.propName}':${bean.propName},</#list>'id':${entity_key}},
  			dataType:"json",
  			async: false,
  			success:function(data){
  				hideLoading();
  				$.messager.alert('提示',data,'info');
  				$('#update${entity_name}Dialog').dialog('close');
  				$('#tt').datagrid('reload');
  			},error:function(data){
  				hideLoading();
  				$.messager.alert('提示',data,'error');
  			}
  		 });
       }
       
       function add${entity_name}Dialog(){
    	   clear();
    	   $('#add${entity_name}Dialog').dialog('open');
       }
       function update${entity_name}Dialog(){
            var chks= $('#tt').datagrid('getChecked');
            if(null!=chks && chks.length==1){
                 	$.ajax({
		    			url:'${r'${'}ctx}//get${entity_name}ById',
		    			type:"POST",
		    			data:{'id':chks[0].${entity_key}},
		    			dataType:"json",
		    			async: false,
		    			success:function(data){
		    				hideLoading();
		    				if(null!=data){
		    				 clear();
		    				 <#list beans as bean>
		    				  <#if bean.propName == bean.keyName>
		    				   $('#u_${bean.propName}').text(data.${bean.propName});
		    				  <#else>
		    				   $('#u_${bean.propName}').val(data.${bean.propName});
		    				  </#if>
				             </#list>
		    				 $('#update${entity_name}Dialog').dialog('open');
		    				}
		    			},error:function(data){
		    				hideLoading();
		    				$.messager.alert('提示',data,'error');
		    			}
		    		});
            }else{
                $.messager.alert('提示',"请选择一项进行修改!",'info');return;
            }
       }
       function delete${entity_name}(){
        	var chks = null;
        	chks = $('#tt').datagrid('getChecked');
        	if(chks.length<1){
        		$.messager.alert('提示','请至少选择一项!','warning');
        		return ;
        	}
        	var arr = new Array();
        	for(var c in chks){
        		arr[c] = chks[c].${entity_key};
        	}
        	$.messager.confirm('提示', '确定要删除该项目吗?', function(yes){
        	   if(yes){
        	   showLoading();
        	      	$.ajax({
		    			url:'${r'${'}ctx}//delete${entity_name}',
		    			type:"POST",
		    			data:{'param':arr.toString()},
		    			dataType:"json",
		    			async: false,
		    			success:function(data){
		    			    hideLoading();
		    				$.messager.alert('提示',data,'info');
		    				$('#tt').datagrid('reload');
		    			},error:function(data){
		    				hideLoading();
		    				$.messager.alert('提示',data,'error');
		    			}
    		       });
        	   }
        	});
       }
       function clear(){
           <#list beans as bean>
            $('#c_${bean.propName}').val('');
            $('#u_${bean.propName}').val('');
		   </#list>
       }
	 </script>
	</body>
</html>